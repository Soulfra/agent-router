<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multi-Model Research Comparison</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }

    header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    header p {
      font-size: 1.2em;
      opacity: 0.9;
    }

    .info-box {
      background: rgba(255, 255, 255, 0.95);
      padding: 20px 30px;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      margin-bottom: 20px;
      color: #333;
    }

    .info-box h3 {
      margin-top: 0;
      margin-bottom: 15px;
      color: #667eea;
      font-size: 1.1em;
    }

    .info-box p {
      margin: 10px 0;
      line-height: 1.6;
      font-size: 0.95em;
    }

    .info-box ul {
      margin: 10px 0;
      padding-left: 25px;
    }

    .info-box li {
      margin: 5px 0;
      line-height: 1.6;
    }

    .info-box .notice {
      background: #fff7ed;
      border-left: 4px solid #f59e0b;
      padding: 12px;
      margin: 15px 0;
      border-radius: 5px;
    }

    .info-box .notice strong {
      color: #c2410c;
    }

    .info-box small {
      color: #666;
      font-size: 0.85em;
    }

    details {
      margin: 15px 0;
    }

    summary {
      cursor: pointer;
      font-weight: bold;
      color: #667eea;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 5px;
      user-select: none;
    }

    summary:hover {
      background: #e9ecef;
    }

    details[open] summary {
      margin-bottom: 10px;
    }

    .query-input {
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      margin-bottom: 30px;
    }

    .query-input h2 {
      margin-bottom: 20px;
      color: #333;
    }

    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    input[type="text"] {
      flex: 1;
      padding: 15px;
      font-size: 16px;
      border: 2px solid #ddd;
      border-radius: 8px;
      transition: border-color 0.3s;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: #667eea;
    }

    button {
      padding: 15px 30px;
      font-size: 16px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .loading {
      text-align: center;
      padding: 40px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      display: none;
    }

    .loading.active {
      display: block;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .results {
      display: none;
    }

    .results.active {
      display: block;
    }

    .summary-card {
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      margin-bottom: 30px;
    }

    .summary-card h2 {
      margin-bottom: 20px;
      color: #333;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .stat-box {
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 10px;
      text-align: center;
    }

    .stat-box .label {
      font-size: 0.9em;
      opacity: 0.9;
      margin-bottom: 5px;
    }

    .stat-box .value {
      font-size: 2em;
      font-weight: bold;
    }

    .consensus-badge {
      display: inline-block;
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 0.9em;
    }

    .consensus-badge.HIGH {
      background: #10b981;
      color: white;
    }

    .consensus-badge.MEDIUM {
      background: #f59e0b;
      color: white;
    }

    .consensus-badge.LOW {
      background: #ef4444;
      color: white;
    }

    .models-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
    }

    .model-card {
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .model-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .model-card.best {
      border: 3px solid #10b981;
      position: relative;
    }

    .model-card.best::before {
      content: 'üëë BEST';
      position: absolute;
      top: -15px;
      right: 20px;
      background: #10b981;
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: bold;
      font-size: 0.9em;
    }

    .model-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 2px solid #f0f0f0;
    }

    .model-name {
      font-size: 1.4em;
      font-weight: bold;
      color: #333;
    }

    .model-score {
      font-size: 1.8em;
      font-weight: bold;
      color: #667eea;
    }

    .model-metrics {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 15px;
    }

    .metric {
      padding: 10px;
      background: #f8f9fa;
      border-radius: 8px;
    }

    .metric .metric-label {
      font-size: 0.85em;
      color: #666;
      margin-bottom: 3px;
    }

    .metric .metric-value {
      font-size: 1.1em;
      font-weight: bold;
      color: #333;
    }

    .bias-badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 15px;
      font-size: 0.85em;
      font-weight: bold;
    }

    .bias-badge.LOW {
      background: #d1fae5;
      color: #065f46;
    }

    .bias-badge.MEDIUM {
      background: #fef3c7;
      color: #92400e;
    }

    .bias-badge.HIGH {
      background: #fee2e2;
      color: #991b1b;
    }

    .model-answer {
      margin-top: 15px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }

    .model-answer .answer-label {
      font-size: 0.9em;
      font-weight: bold;
      color: #666;
      margin-bottom: 8px;
    }

    .model-answer .answer-text {
      color: #333;
      line-height: 1.6;
    }

    .sources-list {
      margin-top: 15px;
      padding: 15px;
      background: #fff7ed;
      border-radius: 8px;
    }

    .sources-list .sources-label {
      font-size: 0.9em;
      font-weight: bold;
      color: #c2410c;
      margin-bottom: 8px;
    }

    .source-item {
      padding: 8px;
      background: white;
      border-radius: 5px;
      margin-bottom: 5px;
      font-size: 0.9em;
    }

    .reasoning-pattern {
      display: inline-block;
      padding: 5px 12px;
      background: #ede9fe;
      color: #5b21b6;
      border-radius: 15px;
      font-size: 0.85em;
      font-weight: bold;
      margin-top: 10px;
    }

    .error {
      background: #fee2e2;
      border: 2px solid #ef4444;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      color: #991b1b;
      display: none;
    }

    .error.active {
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üî¨ Multi-Model Research Comparison</h1>
      <p>Compare how different AI models think, not just what they say</p>
    </header>

    <div class="info-box">
      <h3>üìö What is this?</h3>
      <p>
        This is a <strong>research sandbox</strong> (similar to Google AI Studio or Anthropic Console) that lets you compare
        how different AI models research and reason about the same question. All queries run through your own browser with
        privacy-first web scraping - no external APIs track your searches.
      </p>

      <details>
        <summary>üîç How does it work?</summary>
        <ol>
          <li><strong>You enter a query</strong> (e.g., "What pirate treasure was found in 2025?")</li>
          <li><strong>5+ models research in parallel</strong> (GPT-4, Claude 3.5, DeepSeek, Qwen, Llama)</li>
          <li><strong>Each model:</strong>
            <ul>
              <li>Detects if it needs fresh data (Knowledge Freshness Layer)</li>
              <li>Scrapes the web via your own browser (DuckDuckGo, Wikipedia, news)</li>
              <li>Gets analyzed for bias (crowdfunding, conspiracy, political leaning)</li>
              <li>Answers with reasoning transparency</li>
            </ul>
          </li>
          <li><strong>System compares:</strong> sources used, facts extracted, bias detection, confidence, reasoning patterns</li>
          <li><strong>You see:</strong> side-by-side comparison, best model, consensus score, full reasoning process</li>
        </ol>
      </details>

      <details>
        <summary>‚öñÔ∏è Licensing & Attribution</summary>
        <div class="notice">
          <strong>Important:</strong> Each AI model is subject to its provider's terms of service and usage policies.
        </div>
        <ul>
          <li><strong>GPT-4</strong> - OpenAI Terms of Service (<a href="https://openai.com/policies/terms-of-use" target="_blank">openai.com/policies</a>)</li>
          <li><strong>Claude 3.5 Sonnet</strong> - Anthropic Commercial Terms (<a href="https://www.anthropic.com/legal/commercial-terms" target="_blank">anthropic.com/legal</a>)</li>
          <li><strong>DeepSeek</strong> - DeepSeek API Terms (<a href="https://www.deepseek.com/terms" target="_blank">deepseek.com/terms</a>)</li>
          <li><strong>Qwen 2.5 Coder</strong> - Alibaba Tongyi Qianwen License (Apache 2.0 compatible)</li>
          <li><strong>Llama 3.1</strong> - Meta Llama 3.1 Community License</li>
        </ul>
        <p><small>
          Results are for <strong>research and comparison purposes</strong>. Commercial use requires compliance with each provider's license.
          Web scraping respects robots.txt and rate limits. All data stored encrypted (AES-256-GCM).
        </small></p>
      </details>

      <details>
        <summary>üîí Privacy & Security</summary>
        <ul>
          <li>‚úÖ All queries run through <strong>your own browser</strong> (Puppeteer) - not external APIs</li>
          <li>‚úÖ <strong>No tracking</strong> - Google Analytics, Facebook pixels blocked</li>
          <li>‚úÖ <strong>Rotating user agents</strong> - appear as different browsers</li>
          <li>‚úÖ <strong>Encrypted storage</strong> - all results encrypted (AES-256-GCM)</li>
          <li>‚úÖ <strong>Isolated browsing</strong> - no cookies/history contamination</li>
        </ul>
      </details>

      <details>
        <summary>üí° Example Queries</summary>
        <ul>
          <li>"What pirate treasure was found in 2025?" - <em>Current events with web research</em></li>
          <li>"Explain quantum computing" - <em>Academic topic, compare reasoning depth</em></li>
          <li>"Latest AI developments" - <em>See which model finds most recent news</em></li>
          <li>"UFO sightings in 2025" - <em>Bias detection (conspiracy vs mainstream sources)</em></li>
        </ul>
      </details>
    </div>

    <div class="query-input">
      <h2>Enter Your Research Query</h2>
      <div class="input-group">
        <input
          type="text"
          id="query-input"
          placeholder="e.g., What pirate treasure was found in 2025?"
          value="What pirate treasure was found in 2025?"
        >
        <button id="run-comparison" class="btn-primary">Run Comparison</button>
      </div>
      <p style="color: #666; margin-top: 10px; font-size: 0.9em;">
        This will send your query to GPT-4, Claude 3.5, DeepSeek, Qwen 2.5, and Llama 3.1 in parallel
      </p>
    </div>

    <div class="error" id="error-message"></div>

    <div class="loading" id="loading">
      <div class="spinner"></div>
      <h3>Running comparison across 5 models...</h3>
      <p style="color: #666; margin-top: 10px;">This may take 15-30 seconds</p>
    </div>

    <div class="results" id="results">
      <div class="summary-card">
        <h2>Comparison Summary</h2>
        <div class="stats-grid">
          <div class="stat-box">
            <div class="label">Models Compared</div>
            <div class="value" id="models-count">0</div>
          </div>
          <div class="stat-box">
            <div class="label">Total Time</div>
            <div class="value" id="total-time">0s</div>
          </div>
          <div class="stat-box">
            <div class="label">Consensus</div>
            <div class="value" id="consensus-value">N/A</div>
          </div>
          <div class="stat-box">
            <div class="label">Common Facts</div>
            <div class="value" id="common-facts">0</div>
          </div>
        </div>
        <div style="margin-top: 20px;">
          <strong>Best Model:</strong>
          <span id="best-model-name" style="font-size: 1.2em; color: #667eea;">-</span>
          <br>
          <span id="best-model-reason" style="color: #666; font-size: 0.95em;">-</span>
        </div>
      </div>

      <h2 style="color: white; margin-bottom: 20px;">Model Results</h2>
      <div class="models-grid" id="models-grid"></div>
    </div>
  </div>

  <script>
    const runButton = document.getElementById('run-comparison');
    const queryInput = document.getElementById('query-input');
    const loading = document.getElementById('loading');
    const results = document.getElementById('results');
    const errorMessage = document.getElementById('error-message');
    const modelsGrid = document.getElementById('models-grid');

    runButton.addEventListener('click', async () => {
      const query = queryInput.value.trim();

      if (!query) {
        showError('Please enter a research query');
        return;
      }

      // Show loading, hide results
      loading.classList.add('active');
      results.classList.remove('active');
      errorMessage.classList.remove('active');
      runButton.disabled = true;

      try {
        // Call API (using /query-all endpoint - no database required)
        const response = await fetch('/api/models/query-all', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ question: query, format: 'json', maxTokens: 500 })
        });

        if (!response.ok) {
          const errorData = await response.json().catch(() => ({ error: response.statusText }));
          throw new Error(errorData.error || `API error: ${response.statusText}`);
        }

        const comparison = await response.json();

        // Display results
        displayResults(comparison);

        // Hide loading, show results
        loading.classList.remove('active');
        results.classList.add('active');
      } catch (error) {
        console.error('Comparison failed:', error);

        let errorMsg = error.message;

        // Check if server is running
        if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
          errorMsg = '‚ö†Ô∏è Cannot connect to server. Please check:\n\n' +
                     '1. Server is running (npm start)\n' +
                     '2. Server is accessible at http://localhost:5001\n' +
                     '3. No firewall blocking the connection\n\n' +
                     'Original error: ' + error.message;
        }

        showError(errorMsg);
        loading.classList.remove('active');
      } finally {
        runButton.disabled = false;
      }
    });

    function showError(message) {
      errorMessage.innerHTML = message.replace(/\n/g, '<br>');
      errorMessage.classList.add('active');
    }

    function displayResults(comparison) {
      // Update summary (handle both /compare and /query-all responses)
      const models = comparison.models || [];
      const summary = comparison.summary || {};

      document.getElementById('models-count').textContent = summary.totalModels || models.length;
      document.getElementById('total-time').textContent = ((summary.totalLatency || comparison.totalTime || 0) / 1000).toFixed(1) + 's';

      // Consensus (from /compare) or calculate from successful models
      const consensusLevel = comparison.consensus?.consensusLevel ||
                            (summary.successful > summary.totalModels * 0.7 ? 'high' : 'medium');
      const consensusBadge = `<span class="consensus-badge ${consensusLevel}">${consensusLevel}</span>`;
      document.getElementById('consensus-value').innerHTML = consensusBadge;

      document.getElementById('common-facts').textContent = comparison.analysis?.commonFacts?.length || 'N/A';

      // Best model (from /compare) or find fastest successful
      const bestModel = comparison.bestModel || findBestModel(models);
      document.getElementById('best-model-name').textContent = bestModel.name || bestModel.model || 'N/A';
      document.getElementById('best-model-reason').textContent = bestModel.reason || 'Fastest response';

      // Display model cards
      modelsGrid.innerHTML = '';

      for (const model of models) {
        if (model.status === 'error' || !model.success) continue;

        const isBest = (model.model === bestModel.name) || (model.model === bestModel.model);
        const card = createModelCard(model, isBest);
        modelsGrid.appendChild(card);
      }
    }

    function findBestModel(models) {
      // Find fastest successful model
      const successful = models.filter(m => m.status === 'success');
      if (successful.length === 0) return { name: 'N/A', model: 'N/A' };

      const fastest = successful.reduce((best, current) =>
        current.latency < best.latency ? current : best
      );

      return { name: fastest.model, model: fastest.model };
    }

    function createModelCard(model, isBest) {
      const card = document.createElement('div');
      card.className = 'model-card' + (isBest ? ' best' : '');

      const biasScore = model.biasAnalysis?.biasScore || 'N/A';
      const confidence = model.confidence ? (model.confidence * 100).toFixed(0) : 'N/A';
      const responseTime = model.responseTime || model.latency || 0;
      const answer = model.answer || model.response || 'No response';

      card.innerHTML = `
        <div class="model-header">
          <div class="model-name">${model.model}</div>
          <div class="model-score">${isBest ? 'üèÜ' : '-'}</div>
        </div>

        <div class="model-metrics">
          <div class="metric">
            <div class="metric-label">Confidence</div>
            <div class="metric-value">${confidence}${confidence !== 'N/A' ? '%' : ''}</div>
          </div>
          <div class="metric">
            <div class="metric-label">Sources Used</div>
            <div class="metric-value">${model.sourcesUsed || 0}</div>
          </div>
          <div class="metric">
            <div class="metric-label">Response Time</div>
            <div class="metric-value">${(responseTime / 1000).toFixed(1)}s</div>
          </div>
          <div class="metric">
            <div class="metric-label">Bias Score</div>
            <div class="metric-value"><span class="bias-badge ${biasScore}">${biasScore}</span></div>
          </div>
        </div>

        <div class="reasoning-pattern">${model.reasoningPattern || 'standard'}</div>

        <div class="model-answer">
          <div class="answer-label">Answer</div>
          <div class="answer-text">${truncate(answer, 300)}</div>
        </div>

        ${model.research && model.research.sources ? `
          <div class="sources-list">
            <div class="sources-label">Sources (${model.research.sources.length})</div>
            ${model.research.sources.slice(0, 3).map(source => `
              <div class="source-item">${source.name}</div>
            `).join('')}
          </div>
        ` : ''}
      `;

      return card;
    }

    function truncate(text, maxLength) {
      if (text.length <= maxLength) return text;
      return text.substring(0, maxLength) + '...';
    }

    // Allow Enter key to submit
    queryInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        runButton.click();
      }
    });
  </script>
</body>
</html>
