<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Privacy Checker - CalOS</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Monaco', 'Courier New', monospace; max-width: 1200px; margin: 0 auto; padding: 20px; background: #0f0f23; color: #e0e0e0; }
    h1 { color: #667eea; margin-bottom: 10px; }
    .subtitle { color: #888; margin-bottom: 30px; }
    .section { background: #1a1a2e; border-radius: 10px; padding: 20px; margin-bottom: 20px; border: 1px solid #2a2a3e; }
    .section h2 { color: #764ba2; margin-bottom: 15px; font-size: 18px; }
    button { padding: 12px 20px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; cursor: pointer; font-family: inherit; font-size: 14px; font-weight: 600; }
    button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
    textarea { width: 100%; padding: 15px; background: #0a0a15; border: 1px solid #2a2a3e; border-radius: 5px; color: #e0e0e0; font-family: inherit; font-size: 13px; resize: vertical; }
    .finding { background: #0a0a15; padding: 12px; margin-bottom: 10px; border-radius: 5px; border-left: 3px solid #e74c3c; }
    .finding-title { font-weight: bold; color: #e74c3c; margin-bottom: 5px; }
    .finding-data { background: #000; padding: 8px; border-radius: 3px; font-size: 11px; margin-top: 5px; overflow-x: auto; color: #f39c12; }
    .score { font-size: 48px; font-weight: bold; text-align: center; margin: 20px 0; }
    .score.safe { color: #4caf50; }
    .score.warning { color: #f39c12; }
    .score.danger { color: #e74c3c; }
    .button-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; }
  </style>
</head>
<body>
  <h1>Privacy Checker</h1>
  <p class="subtitle">Find unencrypted PII in JSON - zero dependencies</p>

  <div class="section">
    <h2>JSON Data to Scan</h2>
    <textarea id="data-input" rows="15">{
  "userId": "user-123",
  "email": "john.doe@example.com",
  "phone": "(555) 123-4567",
  "ssn": "123-45-6789",
  "creditCard": "4532-1234-5678-9010",
  "password": "MyPassword123!",
  "apiKey": "sk_live_1234567890abcdef",
  "encrypted_token": "AES256:encrypted_data_here"
}</textarea>
    <br><br>
    <div class="button-grid">
      <button onclick="scanForPII()">Scan for PII</button>
      <button onclick="loadSafeData()">Load Safe Data</button>
      <button onclick="loadUnsafeData()">Load Unsafe Data</button>
      <button onclick="clearResults()">Clear</button>
    </div>
  </div>

  <div class="section" id="score-section" style="display: none;">
    <h2>Privacy Score</h2>
    <div class="score" id="privacy-score">100</div>
    <div style="text-align: center; color: #888;">Lower is better (0 = perfect privacy)</div>
  </div>

  <div class="section">
    <h2>Privacy Findings</h2>
    <div id="findings-container">
      <p style="color: #888; text-align: center; padding: 20px;">Click "Scan for PII" to check for privacy issues...</p>
    </div>
  </div>

  <script>
    const PII_PATTERNS = {
      email: { regex: /\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g, severity: 20, name: 'Email Address' },
      ssn: { regex: /\b\d{3}-\d{2}-\d{4}\b/g, severity: 50, name: 'Social Security Number' },
      creditCard: { regex: /\b\d{4}[-\s]?\d{4}[-\s]?\d{4}[-\s]?\d{4}\b/g, severity: 50, name: 'Credit Card' },
      phone: { regex: /\b(\+\d{1,2}\s?)?\(?\d{3}\)?[\s.-]?\d{3}[\s.-]?\d{4}\b/g, severity: 15, name: 'Phone Number' },
      ip: { regex: /\b\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\b/g, severity: 10, name: 'IP Address' },
      apiKey: { regex: /\b(sk|pk)_live_[A-Za-z0-9]{20,}\b/g, severity: 40, name: 'API Key' }
    };

    const SENSITIVE_FIELDS = ['password', 'secret', 'token', 'key', 'apiKey', 'accessToken', 'privateKey'];

    function scanForPII() {
      const data = document.getElementById('data-input').value;
      const findings = [];
      let score = 0;

      // Scan for PII patterns
      for (const [type, config] of Object.entries(PII_PATTERNS)) {
        const matches = data.match(config.regex);
        if (matches) {
          findings.push({
            type: config.name,
            count: matches.length,
            samples: matches.slice(0, 2),
            severity: config.severity
          });
          score += config.severity * matches.length;
        }
      }

      // Scan for unencrypted sensitive fields
      try {
        const parsed = JSON.parse(data);
        scanObject(parsed, '', findings);
      } catch (e) {
        // Not valid JSON, skip object scan
      }

      // Calculate final score
      score = Math.min(score, 100);

      displayFindings(findings, score);
    }

    function scanObject(obj, path, findings) {
      for (const [key, value] of Object.entries(obj)) {
        const currentPath = path ? `${path}.${key}` : key;
        const isSensitive = SENSITIVE_FIELDS.some(field => key.toLowerCase().includes(field.toLowerCase()));
        const isEncrypted = String(value).match(/^(AES256|RSA|encrypted):/i);

        if (isSensitive && !isEncrypted && typeof value === 'string') {
          findings.push({
            type: 'Unencrypted Sensitive Field',
            field: currentPath,
            severity: 30,
            value: String(value).substring(0, 20) + '...'
          });
        }

        if (typeof value === 'object' && value !== null && !Array.isArray(value)) {
          scanObject(value, currentPath, findings);
        }
      }
    }

    function displayFindings(findings, score) {
      const container = document.getElementById('findings-container');
      const scoreSection = document.getElementById('score-section');
      const scoreElement = document.getElementById('privacy-score');

      scoreSection.style.display = 'block';
      scoreElement.textContent = score;

      if (score === 0) {
        scoreElement.className = 'score safe';
      } else if (score < 50) {
        scoreElement.className = 'score warning';
      } else {
        scoreElement.className = 'score danger';
      }

      if (findings.length === 0) {
        container.innerHTML = '<p style="color: #4caf50; text-align: center; padding: 20px;">âœ“ No privacy issues detected! All data appears secure.</p>';
        return;
      }

      let html = '';
      findings.forEach(finding => {
        html += `
          <div class="finding">
            <div class="finding-title">${finding.type}</div>
            <div style="font-size: 12px; color: #888;">Severity: ${finding.severity}/50</div>
            ${finding.count ? `<div style="font-size: 12px; margin-top: 5px;">Found ${finding.count} instance(s)</div>` : ''}
            ${finding.field ? `<div style="font-size: 12px; margin-top: 5px;">Field: ${finding.field}</div>` : ''}
            ${finding.samples ? `<div class="finding-data">${finding.samples.join(', ')}</div>` : ''}
            ${finding.value ? `<div class="finding-data">${finding.value}</div>` : ''}
          </div>
        `;
      });

      container.innerHTML = html;
    }

    function loadSafeData() {
      document.getElementById('data-input').value = JSON.stringify({
        userId: 'user-123',
        username: 'johndoe',
        role: 'admin',
        encrypted_email: 'AES256:gH7kL9mN2pQ4rS6tU8vW0xY',
        encrypted_phone: 'AES256:aB3cD5eF7gH9iJ1kL3mN5oP',
        encrypted_token: 'AES256:encrypted_data_here'
      }, null, 2);
    }

    function loadUnsafeData() {
      document.getElementById('data-input').value = JSON.stringify({
        userId: 'user-123',
        email: 'john.doe@example.com',
        phone: '(555) 123-4567',
        ssn: '123-45-6789',
        creditCard: '4532-1234-5678-9010',
        password: 'MyPassword123!',
        apiKey: 'sk_live_1234567890abcdef'
      }, null, 2);
    }

    function clearResults() {
      document.getElementById('findings-container').innerHTML = '<p style="color: #888; text-align: center; padding: 20px;">Click "Scan for PII" to check for privacy issues...</p>';
      document.getElementById('score-section').style.display = 'none';
    }
  </script>
</body>
</html>
